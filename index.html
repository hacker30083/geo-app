<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Geography Trainer</title>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; }
    #mapCanvas { border: 1px solid #333; display: block; margin: 0 auto; }
    #controls { margin-top: 10px; }
  </style>
</head>
<body>
  <h1>Geography Trainer</h1>
  <canvas id="mapCanvas"></canvas>
  <div id="controls">
    <label for="answerSelect">What is shown?</label>
    <select id="answerSelect"></select>
    <button id="submitBtn">Submit</button>
    <p id="score">Score: 0/0</p>
  </div>

  <script>
    // === Locations list ===
    const locations = [
      "Ida-Euroopa lauskmaa",
      "Suur Hiina tasandik",
      "Kesktasandik",
      "Suur Tasandik (USA)",
      "Kaspia alamik",
      "Surnumere nõgu",
      "Amazonase",
      "Lääne-Siberi",
      "Mississippi",
      "Induse-Gangese",
      "Iraani kiltmaa",
      "Tiibeti kiltmaa",
      "Mehhiko kiltmaa",
      "Dekkani kiltmaa",
      "Kesk-Siberi kiltmaa",
      "Kordiljeerid",
      "Andid",
      "Kaljumäestik",
      "Apalatšid",
      "Draakonimäed",
      "Atlase mäestik",
      "Austraalia alpid",
      "Suur Veelahkmeahelik",
      "Himaalaja",
      "Suur Kaukasus",
      "Uurali mäestik",
      "Karpaadid",
      "Apenniini mäestik",
      "Püreneed",
      "Skandinaavia",
      "Alpid",
      "Tian Shan",
      "Altai",
      "Verhojanski mäestik",
      "Guajaana mägismaa",
      "Etioopia mägismaa",
      "Brasiilia mägismaa",
      "Patagoonia"
    ];

    // === State ===
    let coords = {};
    let remaining = [];
    let current = null;
    let score = 0, total = 0;

    const canvas = document.getElementById("mapCanvas");
    const ctx = canvas.getContext("2d");
    const answerSelect = document.getElementById("answerSelect");
    const submitBtn = document.getElementById("submitBtn");
    const scoreLabel = document.getElementById("score");

    // Populate dropdown
    locations.forEach((loc, i) => {
      const opt = document.createElement("option");
      opt.value = i + 1; // index matches coords.json numbering
      opt.textContent = loc;
      answerSelect.appendChild(opt);
    });

    // Load map and coords.json
    const mapImage = new Image();
    mapImage.src = "map.png"; // must exist in same folder
    mapImage.onload = () => {
      canvas.width = mapImage.width;
      canvas.height = mapImage.height;
      ctx.drawImage(mapImage, 0, 0);
    };

    fetch("coords.json")
      .then(r => r.json())
      .then(data => {
        coords = data;
        resetQuiz();
      });

    function resetQuiz() {
      remaining = Object.keys(coords).map(n => parseInt(n));
      score = 0;
      total = 0;
      scoreLabel.textContent = `Score: ${score}/${total}`;
      nextQuestion();
    }

    function nextQuestion() {
      if (remaining.length === 0) {
        alert(`Done! Final Score: ${score}/${total}`);
        return;
      }
      const idx = Math.floor(Math.random() * remaining.length);
      current = remaining.splice(idx, 1)[0]; // remove chosen
      // Draw map fresh
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.drawImage(mapImage, 0, 0);
      // Highlight the spot to guess
      const [x, y] = coords[current];
      ctx.beginPath();
      ctx.arc(x, y, 10, 0, 2 * Math.PI);
      ctx.strokeStyle = "orange";
      ctx.lineWidth = 2;
      ctx.stroke();
    }

    submitBtn.addEventListener("click", () => {
      if (current === null) return;
      total++;
      const chosen = parseInt(answerSelect.value);
      if (chosen === current) {
        score++;
        ctx.fillStyle = "green";
        ctx.beginPath();
        ctx.arc(...coords[current], 8, 0, 2 * Math.PI);
        ctx.fill();
      } else {
        // Wrong: red mark
        ctx.fillStyle = "red";
        ctx.beginPath();
        ctx.arc(...coords[current], 8, 0, 2 * Math.PI);
        ctx.fill();
      }
      scoreLabel.textContent = `Score: ${score}/${total}`;
      setTimeout(nextQuestion, 800);
    });
  </script>
</body>
</html>
