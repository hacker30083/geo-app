<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Geography Trainer</title>
  <style>
    body { font-family: sans-serif; text-align: center; }
    #map { width: 800px; height: 500px; border: 1px solid #333; margin: 10px auto; }
    canvas { background: #fff; }
    #controls { margin-top: 10px; }
    #answer { font-weight: bold; margin-top: 10px; }
  </style>
</head>
<body>
  <h1>Geography Trainer</h1>
  <button onclick="startGame()">Start Game</button>
  <button onclick="restartGame()">Restart</button>
  <button onclick="downloadCoords()">Download Coords</button>

  <div id="map"><canvas id="canvas" width="800" height="500"></canvas></div>

  <div id="controls" style="display:none;">
    <label for="guess">Which location is this?</label>
    <select id="guess"></select>
    <button onclick="submitGuess()">Submit</button>
  </div>

  <div id="answer"></div>

  <script>
    let coords = {};
    const locations = [
  "Ida-Euroopa lauskmaa",
  "Suur Hiina tasandik",
  "Kesktasandik",
  "Suur Tasandik (USA)",
  "Kaspia alamik",
  "Surnumere nõgu",
  "Amazonase",
  "Lääne-Siberi",
  "Mississippi",
  "Induse-Gangese",
  "Iraani kiltmaa",
  "Tiibeti kiltmaa",
  "Mehhiko kiltmaa",
  "Dekkani kiltmaa",
  "Kesk-Siberi kiltmaa",
  "Kordiljeerid",
  "Andid",
  "Kaljumäestik",
  "Apalatšid",
  "Draakonimäed",
  "Atlase mäestik",
  "Austraalia alpid",
  "Suur Veelahkmeahelik",
  "Himaalaja",
  "Suur Kaukasus",
  "Uurali mäestik",
  "Karpaadid",
  "Apenniini mäestik",
  "Püreneed",
  "Skandinaavia",
  "Alpid",
  "Tian Shan",
  "Altai",
  "Verhojanski mäestik",
  "Guajaana mägismaa",
  "Etioopia mägismaa",
  "Brasiilia mägismaa",
  "Patagoonia"
];

    let currentCountry = null;
    let guesses = [];
    let maxGuesses = 38;
    let gameOver = false;

    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");
    const mapImage = new Image();
    mapImage.src = "map.png"; // put your map file here

    mapImage.onload = () => drawMap();

    async function loadCoords() {
      try {
        const res = await fetch("coords.json");
        coords = await res.json();
        countries = Object.keys(coords);
        console.log("Loaded coords.json:", coords);

        // populate dropdown
        const sel = document.getElementById("guess");
        sel.innerHTML = "";
        for (const c of countries) {
          const opt = document.createElement("option");
          opt.value = c;
          opt.textContent = c;
          sel.appendChild(opt);
        }
      } catch (e) {
        console.error("Could not load coords.json", e);
      }
    }

    function drawMap() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.drawImage(mapImage, 0, 0, canvas.width, canvas.height);
    }

    function startGame() {
      guesses = [];
      gameOver = false;
      document.getElementById("answer").textContent = "";
      document.getElementById("controls").style.display = "block";
      drawMap();
      pickCountry();
    }

    function restartGame() {
      startGame();
    }

    function pickCountry() {
      if (guesses.length >= maxGuesses) {
        gameOver = true;
        document.getElementById("answer").textContent = "You've finished all guesses!";
        document.getElementById("controls").style.display = "none";
        return;
      }
      const unused = countries.filter(c => !guesses.includes(c));
      if (unused.length === 0) {
        gameOver = true;
        document.getElementById("answer").textContent = "All locations done!";
        document.getElementById("controls").style.display = "none";
        return;
      }
      currentCountry = unused[Math.floor(Math.random() * unused.length)];
      drawMap();
      const [x, y] = coords[currentCountry];
      drawMarker(x, y, "blue"); // show marker
      document.getElementById("answer").textContent = "What is this location?";
    }

    function submitGuess() {
      if (!currentCountry || gameOver) return;
      const sel = document.getElementById("guess");
      const guess = sel.value;

      const [x, y] = coords[currentCountry];
      if (guess === currentCountry) {
        drawMap();
        drawMarker(x, y, "green");
        document.getElementById("answer").textContent = "Correct! It was " + currentCountry;
      } else {
        drawMap();
        drawMarker(x, y, "red");
        document.getElementById("answer").textContent = "Wrong! It was " + currentCountry;
      }
      guesses.push(currentCountry);

      setTimeout(pickCountry, 1500);
    }

    function drawMarker(x, y, color) {
      ctx.drawImage(mapImage, 0, 0, canvas.width, canvas.height);
      ctx.fillStyle = color;
      ctx.beginPath();
      ctx.arc(x, y, 8, 0, 2 * Math.PI);
      ctx.fill();
    }

    function downloadCoords() {
      const blob = new Blob([JSON.stringify(coords, null, 2)], { type: "application/json" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "coords.json";
      a.click();
      URL.revokeObjectURL(url);
    }

    loadCoords();
  </script>
</body>
</html>
